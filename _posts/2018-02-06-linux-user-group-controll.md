---
layout: post
title: Linux用户及用户组管理
date: 2017-12-23T00:00:00.000Z
categories: blog
tags:
  - linux
subtitle: >-
  无论是出于 Linux 本身的多用户多任务分时操作系统的性质，还是出于系统安全的考虑， Linux
  用户和用户组都是这个系统最重要的几块拼图之一。无论是日常使用，还是作为服务器来应用 Linux ，创建合适的用户、组别，赋予相应的权限，是基本的使用技巧。
---

## 概述

Linux系统是一个多用户多任务的分时操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统。

用户的账号一方面可以帮助系统管理员对使用系统的用户进行跟踪，并控制他们对系统资源的访问；另一方面也可以帮助用户组织文件，并为用户提供安全性保护。

每个用户账号都拥有一个惟一的用户名和各自的口令。

用户在登录时键入正确的用户名和口令后，就能够进入系统和自己的主目录。  
完成用户管理的工作有许多种方法，但是每一种方法实际上都是对有关的系统文件进行修改。

## 用户、用户组管理文件介绍

与用户和用户组相关的信息都存放在一些系统文件中，这些文件包括/etc/passwd, /etc/shadow, /etc/group等。

下面分别介绍这些文件的内容。

### 1. /etc/passwd

/etc/passwd文件是用户管理工作涉及的最重要的一个文件。

Linux系统中的每个用户都在/etc/passwd文件中有一个对应的记录行，它记录了这个用户的一些基本属性。

这个文件对所有用户都是可读的。它的内容类似下面的例子：

![](/attach/2018020601.png)

从上面的例子我们可以看到，/etc/passwd中一行记录对应着一个用户，每行记录又被冒号\(:\)分隔为7个字段，其格式和具体含义如下：

![](/attach/2018020602.png)

1. "用户名"是代表用户账号的字符串。      
   通常长度不超过8个字符，并且由大小写字母和/或数字组成。登录名中不能有冒号\(:\)，因为冒号在这里是分隔符。        
   为了兼容起见，登录名中最好不要包含点字符\(.\)，并且不使用连字符\(-\)和加号\(+\)打头。                   
2. “口令”一些系统中，存放着加密后的用户口令字。    
   虽然这个字段存放的只是用户口令的加密串，不是明文，但是由于/etc/passwd文件对所有用户都可读，所以这仍是一个安全隐患。因此，现在许多Linux 系统（如SVR4）都使用了shadow技术，把真正的加密后的用户口令字存放到/etc/shadow文件中，而在/etc/passwd文件的口令字段中只存放一个特殊的字符，例如“x”或者“\*”。  
3. “用户标识号”是一个整数，系统内部用它来标识用户。
   一般情况下它与用户名是一一对应的。如果几个用户名对应的用户标识号是一样的，系统内部将把它们视为同一个用户，但是它们可以有不同的口令、不同的主目录以及不同的登录Shell等。
   通常用户标识号的取值范围是0～65 535。0是超级用户root的标识号，1～99由系统保留，作为管理账号，普通用户的标识号从100开始。在Linux系统中，这个界限是500。  
4. “组标识号”字段记录的是用户所属的用户组。
   它对应着/etc/group文件中的一条记录。   
5. “注释性描述”字段记录着用户的一些个人情况。
   例如用户的真实姓名、电话、地址等，这个字段并没有什么实际的用途。在不同的Linux 系统中，这个字段的格式并没有统一。在许多Linux系统中，这个字段存放的是一段任意的注释性描述文字，用做finger命令的输出。   
6. “主目录”，也就是用户的起始工作目录。
   它是用户在登录到系统之后所处的目录。在大多数系统中，各用户的主目录都被组织在同一个特定的目录下，而用户主目录的名称就是该用户的登录名。各用户对自己的主目录有读、写、执行（搜索）权限，其他用户对此目录的访问权限则根据具体情况设置。   
7. 用户登录后，要启动一个进程，负责将用户的操作传给内核，这个进程是用户登录到系统后运行的命令解释器或某个特定的程序，即Shell。   
   Shell是用户与Linux系统之间的接口。Linux的Shell有许多种，每种都有不同的特点。常用的有sh\(Bourne Shell\), csh\(C Shell\), ksh\(Korn Shell\), tcsh\(TENEX/TOPS-20 type C Shell\), bash\(Bourne Again Shell\)等。 
   系统管理员可以根据系统情况和用户习惯为用户指定某个Shell。如果不指定Shell，那么系统使用sh为默认的登录Shell，即这个字段的值为/bin/sh。   
   用户的登录Shell也可以指定为某个特定的程序（此程序不是一个命令解释器）。
   利用这一特点，我们可以限制用户只能运行指定的应用程序，在该应用程序运行结束后，用户就自动退出了系统。有些Linux 系统要求只有那些在系统中登记了的程序才能出现在这个字段中。   
8. 系统中有一类用户称为伪用户（psuedo users）。
   这些用户在/etc/passwd文件中也占有一条记录，但是不能登录，因为它们的登录Shell为空。它们的存在主要是方便系统管理，满足相应的系统进程对文件属主的要求。
   常见的伪用户如下所示：

![](/attach/2018020603.png)

### 2. /etc/shadow

1. 由于/etc/passwd文件是所有用户都可读的，如果用户的密码太简单或规律比较明显的话，一台普通的计算机就能够很容易地将它破解，因此对安全性要求较高的Linux系统都把加密后的口令字分离出来，单独存放在一个文件中，这个文件是/etc/shadow文件。 有超级用户才拥有该文件读权限，这就保证了用户密码的安全性。   
2. /etc/shadow中的记录行与/etc/passwd中的一一对应，它由pwconv命令根据/etc/passwd中的数据自动产生。

它的文件格式与/etc/passwd类似，由若干个字段组成，字段之间用":"隔开。这些字段是：

![](/attach/2018020604.png)

```
"登录名"是与/etc/passwd文件中的登录名相一致的用户账号

"口令"字段存放的是加密后的用户口令字，长度为13个字符。如果为空，则对应用户没有口令，登录时不需要口令；如果含有不属于集合 { ./0-9A-Za-z }中的字符，则对应的用户不能登录。

"最后一次修改时间"表示的是从某个时刻起，到用户最后一次修改口令时的天数。时间起点对不同的系统可能不一样。例如在SCO Linux 中，这个时间起点是1970年1月1日。

"最小时间间隔"指的是两次修改口令之间所需的最小天数。

"最大时间间隔"指的是口令保持有效的最大天数。

"警告时间"字段表示的是从系统开始警告用户到用户密码正式失效之间的天数。

"不活动时间"表示的是用户没有登录活动但账号仍能保持有效的最大天数。

"失效时间"字段给出的是一个绝对的天数，如果使用了这个字段，那么就给出相应账号的生存期。期满后，该账号就不再是一个合法的账号，也就不能再用来登录了。
```

下面是/etc/shadow的一个例子：

![](/attach/2018020605.png)

### 3. /etc/group

用户组的所有信息都存放在/etc/group文件中。

将用户分组是Linux 系统中对用户进行管理及控制访问权限的一种手段。  
每个用户都属于某个用户组；一个组中可以有多个用户，一个用户也可以属于不同的组。

当一个用户同时是多个组中的成员时，在/etc/passwd文件中记录的是用户所属的主组，也就是登录时所属的默认组，而其他组称为附加组。

用户要访问属于附加组的文件时，必须首先使用newgrp命令使自己成为所要访问的组中的成员。

用户组的所有信息都存放在/etc/group文件中。此文件的格式也类似于/etc/passwd文件，由冒号\(:\)隔开若干个字段，这些字段有：

![](/attach/2018020607.png)

```
"组名"是用户组的名称，由字母或数字构成。与/etc/passwd中的登录名一样，组名不应重复。

"口令"字段存放的是用户组加密后的口令字。一般Linux 系统的用户组都没有口令，即这个字段一般为空，或者是*。

"组标识号"与用户标识号类似，也是一个整数，被系统内部用来标识组。

"组内用户列表"是属于这个组的所有用户的列表/b]，不同用户之间用逗号(,)分隔。这个用户组可能是用户的主组，也可能是附加组。
```

/etc/group文件的一个例子如下：

![](/attach/2018020608.png)

## 用户管理命令

### 1. 添加用户

创建或添加新用户使用 useradd 命令来实现，其命令用法为：

![](/attach/2018020609.png)

该命令的 option 选项较多，常用的主要有：

```
    -c 注释      用户设置对账户的注释说明文字    
    -d 主目录    指定用来取代默认的 / home/username 的主目录        
    -m          若主目录不存在，则创建它。-r 与 - m 相结合，可为系统账户创建主目录    
    -M          不创建主目录   
    -e date     指定账户过期的日期。日期格式为 MM/DD/YY   
    -f days     帐号过期几日后永久停权。若指定为 -，则立即被停权，若为 - 1，则关闭此功能   
    -g 用户组     指定将用户加入到哪个用户组，该用户组必须存在   
    -G 用户组列表 指定用户同时加入的用户组列表，各组用逗分隔   
    -n          不为用户创建私有用户组    
    -s shell    指定用户登录时使用的 shell，默认为 / bin/bash    
    -r          创建一个用户 ID 小于 500 的系统账户，默认不创建对应的主目录   
    -u 用户 ID    手动指定新用户的 ID 值，该值必须唯一，且大于 499   
    -p password 为新建用户指定登录密码。此处的 password 是对应登录密码经 MD5 加密后所得到的密码值，不实真实密码原文，因此在实际应用中，该参数选项使用较少，通常单独使用 passwd 命令来为用户设置登录密码。   
```

示例：

若要创建一个名为 nisj 的用户，并作为 babyfish 用户组的成员，则操作命令为：

![](/attach/2018020610.png)

添加用户时，若未用 - g 参数指定用户组，则系统默认会自动创建一个与用户帐号同名的私有用户组。若不需要创建该私有用户组，则可选用 - n 参数。

比如，添加一个名为 nsj820 的账户，但不指定用户组，其操作结果为：

![](/attach/2018020611.png)

创建用户账户时，系统会自动创建该用户对应的主目录，该目录默认放在 / home 目录下，若要改变位置，可以利用 - d 参数指定；对于用户登录时使用的 shell，默认为 / bin/bash，若要更改，则使用 - s 参数指定。

例如，若要创建一个名为 vodup 的账户，主目录放在 / var 目录下，并指定登录 shell 为 / sbin/nologin，则操作命令为：

![](/attach/2018020612.png)

### 2. 设置帐号属性

对于已创建好的用户，可使用 usermod 命令来修改和设置账户的各项属性，包括登录名，主目录，用户组，登录 shell 等，该命令用法为：

![](/attach/2018020613.png)

部分 option 选项：

（1）改变用户帐户名

使用 - l 参数来实现，命令用法为：

![](/attach/2018020614.png)

例如，若要将用户 nsj820 更名为 nsj0820，则操作命令为：

![](/attach/2018020615.png)

从输出结果可见，用户名已更改为 nsj0820。主目录仍为原来的 / home/nsj820，若也要更改为 / home/nsj0820，则可通过执行以下命令来实现

![](/attach/2018020616.png)

（2）锁定账户

若要临时禁止用户登录，可将该用户账户锁定。锁定账户可利用 - L 参数来实现，其命令用法为：

![](/attach/2018020617.png)

linux 锁定用户，是通过在密码文件 shadow 的密码字段前加 “！” 来标识该用户被锁定。

![](/attach/2018020618.png)

但通过 root 用户进去，然后 su 到被锁定的用户，是可以进去的。

（3）解锁账户

要解锁账户，可以使用带 -U 参数的 usermod 命令来实现。

![](/attach/2018020619.png)

### 3. 删除账户

要删除账户，可以使用 userdel 命令来实现，其用法为：

![](/attach/2018020620.png)

-r 为可选项，若带上该参数，则在删除该账户的同时，一并删除该账户对应的主目录。

![](/attach/2018020621.png)

若要设置所有用户账户密码过期的时间，则可通过修改 / etc/login.defs 配置文件中的 PASS\_MAX\_DAYS 配置项的值来实现，其默认值为 99999，代表用户账户密码永不过期。其中 PASS\_MIN\_LEN 配置项用于指定账户密码的最小长度，默认为 5 个字符。

### 4. 设置用户登录密码

使用 passwd 命令来设置，其命令用法为：

![](/attach/2018020622.png)

若指定了帐户名称，则设置指定账户的登录密码，原密码自动被覆盖。只有 root 用户才有权设置指定账户的密码。一般用户只能设置或修改自己账户的密码（不带参数）。

例如, 若要设置 nisj 账户的登陆密码，则操作命令为：

![](/attach/2018020623.png)

账户登录密码设置后，该账户就可以登录系统了。

### 5. 锁定 / 解锁账户密码及查询密码状态、删除账户密码

在 linux 中，除了用户账户可被锁定外，账户密码也可被锁定，任何一方被锁定后，都将无法登录系统。只有 root 用户才有权执行该命令，锁定账户密码使用带 - l 选项的 passwd 命令，其用法为：

![](/attach/2018020624.png)

要查询当前账户的密码是否被锁定，可以使用带 - S 参数的 passwd 命令来实现，其用法为：

![](/attach/2018020625.png)

例如

![](/attach/2018020626.png)

如要删除账户的密码，使用带 - d 参数的 passwd 命令来实现，该命令也只有 root 用户才有权执行，其用法为：

![](/attach/2018020627.png)

帐户密码被删除后，将不能登录系统，除非重新设置密码。

### 6. 创建用户组

用户和用户组属于多对多关系，一个用户可以同时属于多个用户组，一个用户组可以包含多个不同的用户。

创建用户组使用 groupadd 命令，其命令用法为：

![](/attach/2018020628.png)

若命令带有 - r 参数，则创建系统用户组，该类用户组的 GID 值小于 500；若没有 - r 参数，则创建普通用户组，其 GID 值大于或等于 500.

### 7. 修改用户组属性

用户组创建后，根据需要可对用户组的相关属性进行修改。对用户组属性的修改，主要是修改用户组的名称和用户组的 GID 值。

（1）改变用户组的名称

若要对用户组进行重命名，可使用带 - n 参数的 groupmod 命令来实现，其用法为：

![](/attach/2018020629.png)

对于用户组改名，不会改变其 GID 的值

比如，若要将 student 用户组更名为 teacher 用户组，则操作命令为：

![](/attach/2018020630.png)

（2）重设用户组的 GID

用户组的 GID 值可以重新进行设置修改，但不能与已有用户组的 GID 值重复。对 GID 进行修改，不会改变用户名的名称。

要修改用户组的 GID，可使用带 - g 参数的 groupmod 命令，其用法为：

![](/attach/2018020631.png)

例如，若要将 teacher 组的 GID 更改为 506，则操作命令为：

![](/attach/2018020632.png)

### 8. 删除用户组

删除用户组使用 groupdel 命令来实现，其用法为：

![](/attach/2018020633.png)

在删除用户组时，被删除的用户组不能是某个账户的私有用户组，否则将无法删除，若要删除，则应先删除引用该私有用户组的账户，然后再删除用户组。

![](/attach/2018020634.png)

### 9. 添加用户到指定的组 / 从指定的组中移除用户

可以将用户添加到指定的组，使其成为该组的成员。其实现命令为：

![](/attach/2018020635.png)

若要从用户组中移除某用户，其实现命令为：

![](/attach/2018020636.png)

例如:

![](/attach/2018020637.png)

### 10. 设置用户组管理员

添加用户到组和从组中移除某用户，除了 root 用户可以执行该操作外，用户组管理员也可以执行该操作。

要将某用户指派为某个用户组的管理员，可使用以下命令来实现；

![](/attach/2018020638.png)

用户管理员只能对授权的用户组进行用户管理 \(添加用户到组或从组中删除用户\)，无权对其他用户组进行管理。

![](/attach/2018020639.png)

### 11. 用户其他相关

另外，linux 还提供了 id，whoami 和 groups 等命令，用来查看用户和组的状态。id 命令用于显示当前用户的 uid，gid 和所属的用户组的列表；whoami 用于查询当前用户的名称；groups 用于产看指定用户所隶属的用户组。

同时，我们可以使用图形界面来管理用户和用户组，系统 ---&gt; 管理 ---&gt; 用户和组群可以打开相应的配置界面。

附：  
将一个用户添加到用户组中，千万不能直接用：

![](/attach/2018020640.png)

这样做会使你离开其他用户组，仅仅做为这个用户组 groupA 的成员。

应该用 加上 -a 选项：

![](/attach/2018020641.png)

-a 代表 append， 也就是 将自己添加到 用户组 groupA 中，而不必离开其他用户组。

